<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Echtzeit Lehrer-Tracking</title>
  <link rel="stylesheet" href="/MP.org/styles.css">
  <style>
    /* ZusÃ¤tzliche Optik fÃ¼r Lehrer + Klasse + Fach + Emoji */
    .teacher-cell {
      background: linear-gradient(135deg, #fbcd37 0%, #ffe894 100%);
      font-weight: 700;
      color: #2c3e50;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
      transform: scale(1.02);
      animation: teacherPop 0.4s ease-out;
      font-size: 0.8rem;
    }

    .teacher-line {
      display: flex;
      flex-direction: column;
      gap: 2px;
      align-items: center;
      text-align: center;
    }

    .teacher-name {
      font-weight: 700;
    }

    .teacher-class {
      font-size: 0.75rem;
    }

    .teacher-subject {
      font-size: 0.75rem;
    }

    .teacher-emoji {
      font-size: 1.1rem;
      margin-top: 2px;
    }

    @keyframes teacherPop {
      0% { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1.02); }
    }

    .legend {
      margin-top: 0.8rem;
      font-size: 0.9rem;
      color: #555;
    }
  </style>
</head>
<body>
  <iframe src="../assets/html/header.html"
    onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()">
  </iframe>

  <header class="header">
    <div class="header-content">
      <h1>MP Patentierter HR.284 Echtzeit Lehrer-Tracker</h1>
    </div>
  </header>

  <main>
    <div class="container content">
      <h2>Stundenplan / Raumplan</h2>
      <p>Das ist echt!</p>

      <section class="card">
        <div class="timetable-wrapper">
          <table class="timetable" id="timetable">
            <thead>
              <tr>
                <th>Zeit / Raum</th>
                <th>501</th>
                <th>008</th>
                <th>007</th>
                <th>401</th>
                <th>408</th>
                <th>250</th>
                <th>Disco</th>
                <th>Sporthalle</th>
                <th>Lehrerzimmer</th>
                <th>Sekretariat</th>
              </tr>
            </thead>
            <tbody>
              <tr data-slot="0">
                <th>07:55â€“08:40</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
              <tr data-slot="1">
                <th>08:40-9:25</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
              <tr data-slot="2">
                <th>09:40â€“10:25</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
              <tr data-slot="3">
                <th>10:25â€“11:10</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
              <tr data-slot="4">
                <th>11:25â€“12:10</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
              <tr data-slot="5">
                <th>12:10â€“12:55</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
              <tr data-slot="6">
                <th>13:10â€“13:55</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
              <tr data-slot="7">
                <th>13:55â€“14:40</th>
                <td></td><td></td><td></td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td>
              </tr>
            </tbody>
          </table>
          <div class="legend">
            Aktualisierung in: <span id="countdown">--</span>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <p>MUC-Tracker &copy; 2025</p>
  </footer>

  <script>
    const teachers = [
      "Kabisch",
      "Fitzner",
      "Hoffmann",
      "Jabs",
      "Linnenkugel",
      "Blechmann",
      "Stark Charles",
      "Clever",
      "BÃ¶hmer",
      "Vermaeten",
      "MÃ¼cher",
    ];

    // Klassen: BASIS-25 bis BASIS-23, keine Duplikate pro Refresh
    function buildClassList() {
      const result = [];
      const bases = ["HBFI","HBFT","ITA","HZM","OBMA"];
      const years = [25, 24, 23];
      bases.forEach(base => {
        years.forEach(year => {
          result.push(`${base}-${year}`);
        });
      });
      return result;
    }

    const allClasses = buildClassList(); // 15 eindeutige Klassen

    // FÃ¤cherliste
    const subjects = [
      "MC","DB","PO","ELT","M","SOW",
      "BEN","SP","AM","E","DKM","RL"
    ];

    // Emoji-Liste â€“ absichtlich wild gemischt
    const emojis = [
      "ðŸ˜€","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜","ðŸ˜˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ˜Ž","ðŸ¥¸",
      "ðŸ¤©","ðŸ¥³","ðŸ˜¡","ðŸ¤¬","ðŸ˜±","ðŸ˜´","ðŸ¤¤","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ¥¶","ðŸ¥µ","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘»","ðŸ’€",
      "ðŸ¤–","ðŸŽƒ","ðŸ‘½","ðŸ‘¾","ðŸ¤¡","ðŸ’©","ðŸ‘‹","ðŸ¤š","ðŸ–ï¸","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŠ","ðŸ‘Š",
      "ðŸ™","ðŸ’ª","ðŸ¦µ","ðŸ¦¶","ðŸ‘‚","ðŸ¦»","ðŸ‘ƒ","ðŸ§ ","ðŸ«€","ðŸ«","ðŸ¦·","ðŸ‘€","ðŸ‘ï¸","ðŸ‘…","ðŸ‘„","ðŸ¦´",
      "ðŸŒš","ðŸŒ","ðŸŒž","â­","âš¡","ðŸ”¥","ðŸ’§","ðŸ•","ðŸº","ðŸ§¨","ðŸŽˆ","ðŸŽ‰","ðŸš€","ðŸ›¸","ðŸ’£","ðŸ§¬"
    ];

    const REFRESH_MIN = 20;  // Sekunden
    const REFRESH_MAX = 60;  // Sekunden
    let refreshRemaining = 0;

    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function pickRandomEmoji() {
      return emojis[randomInt(0, emojis.length - 1)];
    }

    function pickRandomSubject() {
      return subjects[randomInt(0, subjects.length - 1)];
    }

    function pickRandomCells() {
      const tbody = document.querySelector("#timetable tbody");
      const rows = Array.from(tbody.querySelectorAll("tr"));
      const allCells = [];

      rows.forEach((row, rowIndex) => {
        const tds = Array.from(row.querySelectorAll("td"));
        tds.forEach((cell, colIndex) => {
          allCells.push({ cell, rowIndex, colIndex });
        });
      });

      // zuerst alles leeren
      allCells.forEach(({ cell }) => {
        cell.textContent = "";
        cell.classList.remove("teacher-cell");
      });

      // zufÃ¤llige Reihenfolge fÃ¼r Zellen, Lehrer, Klassen
      const shuffledCells    = shuffle([...allCells]);
      const shuffledTeachers = shuffle([...teachers]);
      const shuffledClasses  = shuffle([...allClasses]);

      const maxEntries = Math.min(
        shuffledCells.length,
        shuffledTeachers.length,
        shuffledClasses.length
      );

      for (let i = 0; i < maxEntries; i++) {
        const cell = shuffledCells[i].cell;
        const teacher = shuffledTeachers[i];
        const studentClass = shuffledClasses[i]; // jede Klasse max. einmal
        const subject = pickRandomSubject();
        const emoji = pickRandomEmoji();

        cell.classList.add("teacher-cell");
        cell.innerHTML = `
          <div class="teacher-line">
            <span class="teacher-name">${teacher} ${emoji}</span>
            <span class="teacher-class">${studentClass}</span>
            <span class="teacher-subject">${subject}</span>
          </div>
        `;
      }
    }

    function resetRefreshTimer() {
      refreshRemaining = randomInt(REFRESH_MIN, REFRESH_MAX);
      document.getElementById("countdown").textContent = refreshRemaining;
    }

    function tick() {
      refreshRemaining--;
      if (refreshRemaining <= 0) {
        pickRandomCells();
        resetRefreshTimer();
      } else {
        document.getElementById("countdown").textContent = refreshRemaining;
      }
    }

    // Initial
    pickRandomCells();
    resetRefreshTimer();
    setInterval(tick, 1000);
  </script>
</body>
</html>
